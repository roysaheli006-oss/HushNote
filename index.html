<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HushNote Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;1,400&family=Inter:wght@300;400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; transition: background-color 0.8s ease; }
        .font-serif { font-family: 'Playfair Display', serif; }
        .screen { display: none; min-height: 100vh; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; }
        .active { display: flex; }
        .archive-item { border-bottom: 1px solid #D6D3D1; padding: 12px 0; }
        textarea::placeholder { font-style: italic; opacity: 0.4; }
    </style>
</head>
<body class="bg-[#F5F5F4] text-[#44403C]">

    <div id="landing" class="screen active">
        <h1 class="text-7xl font-serif italic animate-pulse">HushNote</h1>
    </div>

    <div id="auth-choice" class="screen">
        <h2 class="text-4xl font-serif mb-12 italic text-[#292524]">HushNote</h2>
        <div class="flex flex-col gap-4 w-full max-w-xs">
            <button onclick="showScreen('register')" class="border border-[#D6D3D1] py-4 hover:bg-[#E7E5E4] uppercase text-xs tracking-[0.2em]">New User</button>
            <button onclick="showScreen('login')" class="border border-[#D6D3D1] py-4 hover:bg-[#E7E5E4] uppercase text-xs tracking-[0.2em]">Already Registered</button>
        </div>
    </div>

    <div id="register" class="screen">
        <div class="w-full max-w-md bg-white/40 p-10 border border-[#D6D3D1]">
            <h2 class="text-2xl font-serif mb-6 italic">Create Your Space</h2>
            <input type="text" id="reg-nick" placeholder="Nickname" class="w-full bg-transparent border-b border-stone-300 mb-6 p-2 outline-none">
            <input type="number" id="reg-age" placeholder="Age" oninput="checkAge(this.value)" class="w-full bg-transparent border-b border-stone-300 mb-6 p-2 outline-none">
            
            <div id="guardian-info" class="hidden mb-6 p-4 bg-stone-200/50 text-[10px] uppercase tracking-widest">
                Guardian Email Required (<15)
                <input type="text" placeholder="Contact Details" class="w-full bg-transparent border-b border-stone-400 mt-2 p-1">
            </div>

            <input type="password" id="reg-pass" placeholder="Set Password" class="w-full bg-transparent border-b border-stone-300 mb-8 p-2 outline-none">
            <button onclick="handleRegister()" class="w-full bg-[#44403C] text-white py-4 text-xs tracking-[0.2em] uppercase mb-4">Register</button>
            <button onclick="showScreen('auth-choice')" class="w-full text-[10px] uppercase tracking-widest opacity-40 hover:opacity-100">Back to Start</button>
        </div>
    </div>

    <div id="login" class="screen">
        <div class="w-full max-w-xs text-center">
            <h2 class="text-2xl font-serif mb-10 italic">Login</h2>
            <input type="text" id="login-nick" placeholder="Nickname" class="w-full bg-transparent border-b border-stone-300 mb-6 p-2 outline-none">
            <input type="password" id="login-pass" placeholder="Password" class="w-full bg-transparent border-b border-stone-300 mb-8 p-2 outline-none">
            
            <button onclick="handleLogin()" class="w-full bg-[#44403C] text-white py-4 text-xs tracking-widest uppercase mb-6">Enter</button>
            
            <p class="text-[10px] uppercase tracking-widest opacity-40">
                Not registered yet? <br>
                <button onclick="showScreen('auth-choice')" class="mt-2 underline hover:text-black">Return to Main Page</button>
            </p>
            
            <p id="login-error" class="text-red-900 text-[10px] mt-4 hidden uppercase tracking-tighter italic">Credentials not found.</p>
        </div>
    </div>

    <div id="modes" class="screen">
        <h2 class="text-[10px] uppercase tracking-[0.4em] opacity-40 mb-12 text-center font-bold">Select Mode</h2>
        <div class="w-full max-w-lg space-y-4">
            <div onclick="showScreen('rant')" class="cursor-pointer p-8 border border-[#D6D3D1] hover:border-stone-800 transition-all bg-white/10">
                <h3 class="text-xl font-serif italic mb-1">Rant</h3>
                <p class="text-[10px] uppercase opacity-50 tracking-widest">A void for immediate release.</p>
            </div>
            <div onclick="initJournal()" class="cursor-pointer p-8 border border-[#D6D3D1] hover:border-stone-800 transition-all bg-white/10">
                <h3 class="text-xl font-serif italic mb-1">Journal</h3>
                <p class="text-[10px] uppercase opacity-50 tracking-widest">Personal archive & reflection.</p>
            </div>
            <div onclick="showScreen('support-gate')" class="cursor-pointer p-8 border border-[#D6D3D1] hover:border-stone-800 transition-all bg-white/10">
                <h3 class="text-xl font-serif italic mb-1">Emotional Support</h3>
                <p class="text-[10px] uppercase opacity-50 tracking-widest">Minimalist backchannel listening.</p>
            </div>
        </div>
        <button onclick="logout()" class="mt-12 text-[10px] uppercase tracking-widest underline opacity-30">Logout</button>
    </div>

    <div id="journal" class="screen">
        <div class="w-full max-w-2xl h-[75vh] flex flex-col">
            <div class="flex justify-between items-baseline mb-8">
                <h2 class="font-serif italic text-2xl" id="journal-title">Archive</h2>
                <button onclick="newJournalEntry()" id="new-entry-btn" class="text-[10px] uppercase border border-stone-400 px-4 py-1">New Entry</button>
            </div>
            <div id="archive-list" class="flex-grow overflow-y-auto pr-4"></div>
            <div id="journal-editor" class="hidden h-full flex flex-col">
                <span id="journal-time" class="text-[9px] uppercase opacity-40 font-mono mb-2"></span>
                <textarea id="journal-input" placeholder="Begin writing..." class="flex-grow bg-transparent outline-none text-lg font-serif italic leading-relaxed resize-none"></textarea>
                <div class="flex justify-between mt-6 pt-4 border-t border-stone-200">
                    <button onclick="insertPrompt()" class="text-[10px] uppercase tracking-widest opacity-50 hover:opacity-100">Get Prompt</button>
                    <button onclick="saveJournal()" class="bg-[#44403C] text-white px-8 py-2 text-xs tracking-widest uppercase">Save</button>
                </div>
            </div>
        </div>
        <button onclick="showScreen('modes')" class="mt-8 text-[10px] uppercase tracking-[0.3em] opacity-40">Back</button>
    </div>

    <div id="support" class="screen">
        <div class="w-full max-w-xl h-[70vh] flex flex-col">
            <div id="chat-box" class="flex-grow overflow-y-auto mb-6 p-6 font-serif italic space-y-6 text-sm">
                <p class="text-center text-[9px] uppercase opacity-30 tracking-[0.5em] mb-10">Listening Mode Active</p>
            </div>
            <div class="flex flex-col gap-4">
                <textarea id="support-input" placeholder="Type here..." class="w-full h-24 bg-transparent border border-stone-300 p-4 outline-none font-serif text-base resize-none"></textarea>
                <div class="flex justify-between items-center">
                    <button onclick="showScreen('modes')" class="text-[10px] uppercase tracking-widest opacity-40 font-bold">End Session</button>
                    <button onclick="handleSupportAI()" class="bg-black text-white px-10 py-3 text-[10px] uppercase tracking-widest">Send</button>
                </div>
            </div>
        </div>
    </div>

    <div id="rant" class="screen p-0 bg-[#1C1917]">
        <div class="w-full h-screen p-12 flex flex-col text-[#D6D3D1]">
            <textarea placeholder="Release your thoughts into the void..." class="flex-grow bg-transparent border-none outline-none text-xl font-serif italic leading-loose resize-none"></textarea>
            <div class="flex justify-between items-center mt-6">
                <button onclick="showScreen('modes')" class="text-[10px] uppercase tracking-widest opacity-40">Discard</button>
                <button onclick="showScreen('modes')" class="border border-stone-700 px-12 py-3 text-[10px] uppercase tracking-widest">Dump it</button>
            </div>
        </div>
    </div>

    <div id="support-gate" class="screen">
        <div class="max-w-md bg-white p-10 border-t-4 border-black shadow-xl">
            <h2 class="text-2xl font-serif mb-4 text-red-900 italic font-bold text-center">Safety Gate</h2>
            <p class="text-xs text-stone-600 mb-6 leading-relaxed italic text-center">This AI acts only as a minimalist listener. By entering, you consent to anonymous professional evaluation for safety purposes.</p>
            <div class="flex items-start gap-3 mb-8 bg-stone-50 p-4 border border-stone-200">
                <input type="checkbox" id="eval-consent" class="mt-1 accent-black" onchange="toggleGateBtn()">
                <label for="eval-consent" class="text-[10px] uppercase text-stone-500 leading-tight font-bold">I Consent & Accept Terms</label>
            </div>
            <button id="gate-btn" onclick="enterSupport()" class="w-full bg-stone-200 text-stone-400 py-4 text-xs tracking-widest uppercase cursor-not-allowed" disabled>Proceed</button>
        </div>
    </div>

    <script>
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.body.style.backgroundColor = (id === 'rant') ? "#1C1917" : "#F5F5F4";
            document.body.style.color = (id === 'rant') ? "#D6D3D1" : "#44403C";
        }

        setTimeout(() => showScreen('auth-choice'), 2500);

        function handleRegister() {
            const nick = document.getElementById('reg-nick').value;
            const pass = document.getElementById('reg-pass').value;
            if(!nick || !pass) return alert("Nickname and password required.");
            localStorage.setItem('hush_nick', nick);
            localStorage.setItem('hush_pass', pass);
            alert("Registered. Please login.");
            showScreen('login');
        }

        function handleLogin() {
            const nick = document.getElementById('login-nick').value;
            const pass = document.getElementById('login-pass').value;
            if(nick === localStorage.getItem('hush_nick') && pass === localStorage.getItem('hush_pass')) {
                showScreen('modes');
            } else {
                document.getElementById('login-error').classList.remove('hidden');
            }
        }

        function logout() { showScreen('auth-choice'); }

        // Journal logic
        let archive = JSON.parse(localStorage.getItem('hush_archive')) || [];
        function initJournal() {
            showScreen('journal');
            document.getElementById('journal-editor').classList.add('hidden');
            document.getElementById('archive-list').classList.remove('hidden');
            document.getElementById('new-entry-btn').classList.remove('hidden');
            document.getElementById('journal-title').innerText = "Archive";
            renderArchive();
        }
        function newJournalEntry() {
            document.getElementById('archive-list').classList.add('hidden');
            document.getElementById('new-entry-btn').classList.add('hidden');
            document.getElementById('journal-editor').classList.remove('hidden');
            document.getElementById('journal-title').innerText = "New Entry";
            document.getElementById('journal-input').value = "";
            document.getElementById('journal-time').innerText = new Date().toLocaleString();
        }
        function saveJournal() {
            const text = document.getElementById('journal-input').value;
            if(!text.trim()) return;
            archive.push({ date: new Date().toLocaleString(), content: text });
            localStorage.setItem('hush_archive', JSON.stringify(archive));
            initJournal();
        }
        function renderArchive() {
            const list = document.getElementById('archive-list');
            list.innerHTML = archive.length === 0 ? "<p class='italic opacity-40 text-center py-10'>The archive is empty.</p>" : "";
            archive.slice().reverse().forEach(entry => {
                list.innerHTML += `<div class="archive-item">
                    <p class="text-[9px] uppercase opacity-40">${entry.date}</p>
                    <p class="text-sm italic">${entry.content.substring(0, 100)}...</p>
                </div>`;
            });
        }

        // AI Listener Logic
        function handleSupportAI() {
            const input = document.getElementById('support-input');
            const chat = document.getElementById('chat-box');
            if(!input.value.trim()) return;
            chat.innerHTML += `<div class="text-right text-stone-800 my-4">"${input.value}"</div>`;
            const responses = ["I hear you.", "I am listening.", "Please continue.", "Iâ€™m here.", "Thank you for sharing."];
            const reply = responses[Math.floor(Math.random() * responses.length)];
            const typing = document.createElement('div');
            typing.className = "text-stone-400 text-xs italic animate-pulse";
            typing.innerText = "...";
            chat.appendChild(typing);
            chat.scrollTop = chat.scrollHeight;
            setTimeout(() => {
                typing.remove();
                chat.innerHTML += `<div class="text-stone-500 border-l border-stone-300 pl-4 my-4">${reply}</div>`;
                chat.scrollTop = chat.scrollHeight;
            }, 1200);
            input.value = "";
        }

        function toggleGateBtn() {
            const btn = document.getElementById('gate-btn');
            const isChecked = document.getElementById('eval-consent').checked;
            btn.disabled = !isChecked;
            btn.classList.toggle('bg-black', isChecked);
            btn.classList.toggle('text-white', isChecked);
            btn.classList.toggle('cursor-pointer', isChecked);
        }
        function enterSupport() { showScreen('support'); }
        function checkAge(val) { document.getElementById('guardian-info').classList.toggle('hidden', parseInt(val) >= 15 || !val); }
        function insertPrompt() {
            const p = ["What is the loudest thought in your head?", "Where do you feel tension?", "What did you learn today?"];
            document.getElementById('journal-input').value += `\n[Reflect: ${p[Math.floor(Math.random()*p.length)]}]\n`;
        }
    </script>
</body>
</html>